#!/usr/bin/env zsh

usage() {
	echo "usage: $0 [toggle]"
	exit 2
}

# set -x

# paths
source ~/.zshrc
export LUNARVIM_CONFIG_DIR="${LUNARVIM_CONFIG_DIR:-$HOME/.config/lvim}"
export LUNARVIM_RUNTIME_DIR="${LUNARVIM_RUNTIME_DIR:-$HOME/.local/share/lunarvim}"

start_ide() {
	NVIM_LISTEN_ADDRESS=/tmp/nvimsocket kitty --detach --config ~/.config/kitty/ide.conf --class ide ~/.local/bin/lvim
}

start_lvim() {
	NVIM_LISTEN_ADDRESS=/tmp/nvimsocket lvim "$@"
}

if [ "$1" = "--help" ]; then
	usage
elif [ "$1" = "toggle" ]; then
    if ! pgrep -f "\-\-class ide"; then
        start_ide
    fi
    i3-msg '[class="ide"] focus'
elif [ "$1" = "new" ]; then
	start_ide
elif [ "$1" = "term" ]; then
	start_lvim "$@"
else
	nvr --remote "$@"
fi

exit 0
